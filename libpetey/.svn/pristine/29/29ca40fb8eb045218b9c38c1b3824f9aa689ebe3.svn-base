#include <readline/readline.h>
#include <readline/history.h>

#include "grammar_t"

int main(int argc, void **argv) {
  grammar_t grammar;
  char *line;
  parse_tree *pt;
  int nerr;

  nerr=grammar.load(argv[1]);

  if (nerr>0) {
    fprintf(stderr, "The grammer in %s contained %d errors\n", argv[1], nerr);
  }

  while (feof(stdin)==0) {
    line=readline("*GG*");
    if (strlen(line)>1) add_history(line);

    pt=grammar.parse(line);

    if (pt==NULL) {
      printf("'%s' is not a valid expression\n");
    } else {
      pt->print(stdout);
      delete pt;
    }
  }

  return nerr;

}
    
